<html lang="en">
<head>
	<script src="js/jquery.min.js"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/bootstrap-multiselect.js"></script>
	<link rel="stylesheet" href="css/bootstrap-multiselect.css" type="text/css"/>
	<script src="js/d3.v3.min.js"></script>
	<script src="js/topojson.v1.js"></script>
	<style>
		body {
		  font: 10px sans-serif;
		}

		.axis path,
		.axis line {
		  fill: none;
		  stroke: #000;
		}
		.chartToolTip {
		    position: absolute;
		    display: none;
		    width: auto;
		    height: auto;
		    background: none repeat scroll 0 0 white;
		    border: 0 none;
		    border-radius: 8px 8px 8px 8px;
		    box-shadow: -3px 3px 15px #888888;
		    color: black;
		    font: 12px sans-serif;
		    padding: 5px;
		    text-align: center;
		}
		.navbar {
		    height: 55px;
		    background-color: #2196F3;
		    color: #fff;
		    border: none;
		}
		.navbar .navbar-brand {
		    text-shadow: 0px 1px 5px #918C8C;
		    padding: 15px;
		    margin-left: 20px;
		    font-size: 2.3em;
		    color: #FFFFFF !important;
		}
		.user-name span {
		    font-size: 16px;
		    font-weight: bold;
		    font-family: "open sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
		}
		ul li {
		    list-style: none;
		}
		.user-name {
		    padding-top: 15px;
		    padding-right: 10px;
		}
		.avatar {
		    height: 40px;
		    width: 40px;
		    border: 4px solid #108DB6 !important;
		    margin-top: 5px;
		}
		.tooltip2{
			text-anchor: left;
			font-family: times-serif;
			font-size: 14px;
			font-weight: bold;
			fill:red;	
		}

		.tooltip3{
			text-anchor: left;
			font-family: times-serif;
			font-size: 14px;
			font-weight: bold;
			fill:aqua;	
		}

		.tooltip4{
			text-anchor: left;
			font-family: times-serif;
			font-size: 14px;
			font-weight: bold;
			fill:yellow;	
		}


		.tooltip5{
			text-anchor: left;
			font-family: times-serif;
			font-size: 14px;
			font-weight: bold;
			fill:purple;	
		}
		ul.nav.nav-pills li {
		    margin-top: 10px;
		}
	</style>
</head>
<body style="background: #D7DBDD;">
	<script type="text/javascript">
		var div;
		div = d3.select("body").append("div").attr("class", "chartToolTip");
	</script>
	<!-- start: Header -->
	<nav class="navbar navbar-default header navbar-fixed-top">
		<div class="col-md-12 nav-wrapper">
			<div class="navbar-header" style="width:100%;">
				<a href="index.html" class="navbar-brand"> 
					<b>INDIA Spectrum Auction 2016</b>
				</a>

				<ul class="nav navbar-nav navbar-right user-nav">
					<li class="user-name"><span>Presented By IIIT Banglore</span></li>
					<li>
						<img src="logo.jpg" class="img-circle avatar" alt="user name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"/>
					</li>
					<li>&nbsp;</li>
				</ul>
			</div>
		</div>
	</nav>
	<!-- end: Header -->

	<div class="container-fluid" style="margin-top:60px;">
		<div class="panel panel-default">
			<div class="panel-body">
				<ul class="nav nav-pills">
					<li role="presentation" class="active"><a class="last menu">Winning Bid Prices</a></li>
					<li role="presentation" class="active"><a class="b800 menu">800 MHz Prices</a></li>
					<li role="presentation" class="active"><a class="b900 menu" >900 MHz Prices</a></li>
					<li role="presentation" class="active"><a class="b1800 menu">1800 MHz Prices</a></li>
					<li role="presentation" class="active"><a class="b2100 menu">2100 MHz Prices</a></li>
					<li role="presentation" class="active"><a class="bAll menu">All Band Prices</a></li>
				</ul>
				<h4 class="day">Loading....</h4>
				<div id="indiamap"></div>
				<script>
					
					function draw(geo_data) 
					{

						var margin = 25,
						    width = 1000 - margin,
						    height = 600 - margin;

						var svg = d3.select("#indiamap")
						    .append("svg")
						    .attr("width", width + margin)
						    .attr("height", height + margin)
						    .append('g')
						    .attr('class', 'map');

						var projection = d3.geo.mercator()
						                       .scale(1000)
						                       .translate([-1150, 700]);
						var path = d3.geo.path().projection(projection);

						var state_geojson = topojson.feature(geo_data, geo_data.objects.india_state_2014);

						var map = svg.selectAll('path')
						             .data(state_geojson.features)
						             .enter()
						             .append('path')
						             .attr('d', path)
						             .style('fill', 'white')
						             .style('stroke', 'black')
						             .style('stroke-width', 0.5)
						             .attr("class", function(d){ return "state " + d.properties.ST_NAME;})

						var color = d3.scale.ordinal()
						.range(["orange", "blue", "yellow", "purple", "#a05d56", "#d0743c", "#ff8c00"]);


						function plot_points(data)
						{
							
							d3.select("h4.day").text("");
							var nestData = d3.nest().key(function(d){return (d['Area']+d['Band']+d['Day'])}).entries(data);
							var max_price = d3.max(nestData, function(d){return +d.values[0]['Price']})
							//var max_price =2000;
							console.log(max_price);
							var radius = d3.scale.linear()
								.domain([0,max_price])
								.range([0,40]);

						    svg.append('g')
						       .attr("class", "bubble")
						       .selectAll("circle")
							   .data(nestData.sort(function(a,b){
										return +b.values[0]['Price'] - +a.values[0]['Price']
									}),key_func)
						       .enter()
						       .append("circle")
						       .attr('cx', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[0]; })
						       .attr('cy', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[1]; })
						       .attr('r', function(d){return radius(+d.values[0]['Price'])})
							   .attr('class',function(d){return 'b'+d.values[0]['Band']})
							   .attr('fill','green');
						
							d3.selectAll("g.bubble").selectAll('circle.b800').attr('fill','orange').attr('opacity',0.6);
							d3.selectAll("g.bubble").selectAll('circle.b900').attr('fill','red').attr('opacity',0.6);
							d3.selectAll("g.bubble").selectAll('circle.b1800').attr('fill','green').attr('opacity',0.6);
							d3.selectAll("g.bubble").selectAll('circle.b2100').attr('fill','purple').attr('opacity',0.6);
							function key_func(d) 
							{
							        return d['key'];
							}

							function update(currentRound,band)
							{
								d3.select("h4.day").text("Day "+currentRound);
								var filtered = nestData.filter(function(d){
									if(band){
										console.log("Hello")
										return d.values[0]['Day'] == currentRound && d.values[0]['Band'] == band;
									}
									else{
										return d.values[0]['Day'] == currentRound
									}
								})

								var circles = d3.select("g.bubble").selectAll('circle').data(filtered,key_func)

								circles.exit().remove();
								circles.enter()
										.append("circle")
										.attr('cx', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[0]; })
										.attr('cy', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[1]; })
										.attr('r', function(d){return radius(+d.values[0]['Price'])})
										.attr('class',function(d){return 'b'+d.values[0]['Band']})
										.attr('fill','green');
								d3.selectAll("g.bubble").selectAll('circle.b800').attr('fill','red').attr('opacity',0.6);
								d3.selectAll("g.bubble").selectAll('circle.b900').attr('fill','aqua').attr('opacity',0.6);
								d3.selectAll("g.bubble").selectAll('circle.b1800').attr('fill','yellow').attr('opacity',0.5);
								d3.selectAll("g.bubble").selectAll('circle.b2100').attr('fill','purple').attr('opacity',0.6);

								
								var legend2 = svg.append("g")
												.attr("class", "legend2")
												.attr("transform", "translate(" + (width - 350) + "," + 280 + ")")
												.selectAll("g")
												.data(["800 MHz"])
												.enter().append("g")
												.append("text")
												.attr("y", function(d, i) {
												  return i * 30 + 5;
												  })
												.attr("class","tooltip2")
													.text(function(d) {
												  return d;
												   });

								var legend3 = svg.append("g")
												.attr("class", "legend3")
												.attr("transform", "translate(" + (width - 350) + "," + 310 + ")")
												.selectAll("g")
												.data(["900 MHz"])
												.enter().append("g")
												.append("text")
												.attr("y", function(d, i) {
													  return i * 30 + 5;
												  	})
												.attr("class","tooltip3")
													.text(function(d) {
												  	return d;
												   	});

								var legend4 = svg.append("g")
												.attr("class", "legend4")
												.attr("transform", "translate(" + (width - 350) + "," + 340 + ")")
												.selectAll("g")
												.data(["1800 MHz"])
												.enter().append("g")
												 .append("text")
												.attr("y", function(d, i) {
												  return i * 30 + 5;
												  })
												.attr("class","tooltip4")
													.text(function(d) {
												  return d;
												   });

								var legend5 = svg.append("g")
													.attr("class", "legend5")
													.attr("transform", "translate(" + (width - 350) + "," + 370 + ")")
													.selectAll("g")
													.data(["2100 MHz"])
													.enter().append("g")
													.append("text")
													.attr("y", function(d, i) {
													  	return i * 30 + 5;
													  })
													.attr("class","tooltip5")
														.text(function(d) {
													  		return d;
													   });
							}

							function clearData()
							{
								var filtered = nestData.filter(function(d){
									return d.values[0]['Day'] == '';
								})

								var circles = d3.select("g.bubble").selectAll('circle').data(filtered,key_func)

								circles.exit().remove();

								circles.enter()
										.append("circle")
										.attr('cx', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[0]; })
										.attr('cy', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[1]; })
										.attr('r', function(d){return radius(+d.values[0]['Price'])})
										.attr('class',function(d){return 'b'+d.values[0]['Band']})
										.attr('fill','green');
								d3.selectAll("g.bubble").selectAll('circle.b800').attr('fill','red').attr('opacity',0.6);
								d3.selectAll("g.bubble").selectAll('circle.b900').attr('fill','aqua').attr('opacity',0.6);
								d3.selectAll("g.bubble").selectAll('circle.b1800').attr('fill','yellow').attr('opacity',0.5);
								d3.selectAll("g.bubble").selectAll('circle.b2100').attr('fill','purple').attr('opacity',0.6);

								//adding legend

								var legend2 = svg.append("g")
												.attr("class", "legend2")
												.attr("transform", "translate(" + (width - 350) + "," + 280 + ")")
												.selectAll("g")
												.data(["800 MHz"])
												.enter().append("g")
												.append("text")
												.attr("y", function(d, i) {
													return i * 30 + 5;
													})
												.attr("class","tooltip2")
												.text(function(d) {
													return d;
													});


								var legend3 = svg.append("g")
												.attr("class", "legend3")
												.attr("transform", "translate(" + (width - 350) + "," + 310 + ")")
												.selectAll("g")
												.data(["900 MHz"])
												.enter().append("g")
												.append("text")
												.attr("y", function(d, i) {
													return i * 30 + 5;
													})
												.attr("class","tooltip3")
												.text(function(d) {
													return d;
													});


								var legend4 = svg.append("g")
												.attr("class", "legend4")
												.attr("transform", "translate(" + (width - 350) + "," + 340 + ")")
												.selectAll("g")
												.data(["1800 MHz"])
												.enter().append("g")
												.append("text")
												.attr("y", function(d, i) {
													return i * 30 + 5;
													})
												.attr("class","tooltip4")
												.text(function(d) {
													return d;
													});



								var legend5 = svg.append("g")
													.attr("class", "legend5")
													.attr("transform", "translate(" + (width - 350) + "," + 370 + ")")
													.selectAll("g")
													.data(["2100 MHz"])
													.enter().append("g")
													.append("text")
													.attr("y", function(d, i) {
														return i * 30 + 5;
														})
													.attr("class","tooltip5")
													.text(function(d) {
														return d;
														});	
							}

							var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
							var round_index = 0;
							update("19");
							d3.selectAll("a.last").on("click",renderLast)
							d3.selectAll("a.b800").on("click",render800)
							d3.selectAll("a.b900").on("click",render900)
							d3.selectAll("a.b1800").on("click",render1800)
							d3.selectAll("a.b2100").on("click",render2100)
							d3.selectAll("a.bAll").on("click",renderAll)
							
							function renderLast()
							{
								clearData();
								update("19")
							}
							function render800()
							{
								clearData();
								var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
								var round_index = 0;
								var round_interval = setInterval(function(){
									update(rounds[round_index],"800");
									round_index++;
									if(round_index>=rounds.length){
										clearInterval(round_interval)
									}
								},1000);		
							}
							function render900()
							{
								clearData();
								var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
								var round_index = 0;
								var round_interval = setInterval(function(){
									update(rounds[round_index],"900");
									round_index++;
									if(round_index>=rounds.length){
										clearInterval(round_interval)
									}
								},1000);		
							}
							function render1800()
							{
								clearData();
								var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
								var round_index = 0;
								var round_interval = setInterval(function(){
									update(rounds[round_index],"1800");
									round_index++;
									if(round_index>=rounds.length){
										clearInterval(round_interval)
									}
								},1000);		
							}
							function render2100()
							{
								d3.selectAll("a.menu").style("visibility","hidden")
								clearData();
								var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
								var round_index = 0;
								var round_interval = setInterval(function(){
									update(rounds[round_index],"2100");
									round_index++;
									if(round_index>=rounds.length){
										clearInterval(round_interval)
									}
								},1000);	
								d3.selectAll('a.menu').style('visibility','visible')	
							}
							function renderAll()
							{
								clearData();
								var rounds = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"]
								var round_index = 0;
								var round_interval = setInterval(function(){
									update(rounds[round_index]);
									round_index++;
									if(round_index>=rounds.length){
										clearInterval(round_interval)
									}
								},1000);	
							}
						}


						var format = d3.time.format("%d-%m-%Y (%H:%M h)");
						d3.csv("data/full_auction_data.csv", plot_points);


					};

					d3.json("data/india_state_2014_simplified.topojson", draw);
				</script>
			</div>
		</div>
		<div class="panel panel-default">
	  		<div class="panel-body">
				<ul style="list-style: none;">
					<li>&nbsp;</li>
					<li>
						<ul class="nav nav-pills">
							<li class="circle active" data-circle="Delhi"><a>Delhi</a></li>
							<li class="circle" data-circle="Mumbai"><a>Mumbai</a></li>
							<li class="circle" data-circle="Kolkata"><a>Kolkata</a></li>
							<li class="circle" data-circle="Andhra Pradesh"><a>Andhra Pradesh</a></li>
							<li class="circle" data-circle="Gujarat"><a>Gujarat</a></li>
							<li class="circle" data-circle="Maharashtra"><a>Maharashtra</a></li>
							<li class="circle" data-circle="Tamil Nadu. Chennai"><a>Tamil Nadu. Chennai</a></li>
							<li class="circle" data-circle="Haryana"><a>Haryana</a></li>
							<li class="circle" data-circle="Kerala"><a>Kerala</a></li>
							<li class="circle" data-circle="MP"><a>MP</a></li>
							<li class="circle" data-circle="Punjab"><a>Punjab</a></li>
							<li class="circle" data-circle="Rajasthan"><a>Rajasthan</a></li>
							<li class="circle" data-circle="UP(E)"><a>UP(E)</a></li>
							<li class="circle" data-circle="UP(W)"><a>UP(W)</a></li>
							<li class="circle" data-circle="Assam"><a>Assam</a></li>
							<li class="circle" data-circle="Bihar"><a>Bihar</a></li>
							<li class="circle" data-circle="HP"><a>HP</a></li>
							<li class="circle" data-circle="J&amp;K"><a>J&amp;K</a></li>
							<li class="circle" data-circle="NE"><a>NE</a></li>
							<li class="circle" data-circle="Orissa"><a>Orissa</a></li>
							<li class="circle" data-circle="WB, A&amp;N"><a>WB, A&amp;N</a></li>
						</ul>
					</li>
					<li>&nbsp;</li>
					<li>
						<select id="frequency" multiple="multiple">
							<optgroup label="Group 1">
								<option data-mhz="800" selected>800 MHz</option>
								<option data-mhz="900" selected>900 MHz</option>
								<option data-mhz="1800" selected>1800 MHz</option>
								<option data-mhz="2100"  selected>2100 MHz</option>
								<option data-mhz="2300" selected>2300 MHz</option>
								<option data-mhz="2600"  selected>2600 MHz</option>
							</optgroup>
						</select>
					</li>
				</ul>
				<div id="sec2" style="clear: both; ">
					<div id="stackedBarChart" style="float:left"></div>
					<div id="pieChart" style="float:left"></div>
				</div>
				<script>

					
					$(document).ready(function()
										{
											var freq={
														mhz800:true,
														mhz900:true,
														mhz1800:true,
														mhz2100:true,
														mhz2300:true,
														mhz2600:true
													};
											
											
											displayCharts("Delhi",freq);
											$(".circle").click(function()
																{
																	displayCharts(this.getAttribute("data-circle"),freq);
																	$(".circle").removeClass("active");
																	$(this).addClass("active");
																}
															  );

										  	$('#frequency').multiselect({
											  enableClickableOptGroups: true,
											  onDropdownHide: function(event) {
											                displayCharts($(".circle.active").attr("data-circle"),freq);
											            },
											  onChange: function(element, checked) {
											                freq["mhz"+element.attr("data-mhz")]=checked;
											            }
											});
										}
									 );
					function displayCharts(circle,freq)
					{
						loadBarChart(circle,freq);
						loadPieChart(circle,freq);
					}
					function loadPieChart(circle,freq)
					{
						var width = 350,
							height = 350,
							radius = Math.min(width, height) / 2;

						var color = d3.scale.category10();
						    

						var arc = d3.svg.arc()
						    .outerRadius(radius-10)
						    .innerRadius(radius/2-10);

						var totalHolding=0;

						$("#pieChart").html("");
						var svg = d3.select("#pieChart")
							.append("svg")
							.attr("width", width )
							.attr("height", height )
							.attr("style","margin-top:50px;margin-left:20px;")
							.append("g")
							.attr("transform", "translate(" + radius + "," + radius + ")");

						d3.select("#pieChart")
						.append("h4")
						.text("Distribution among operators")
						.attr("style","text-align:center;");

						d3.csv(
								"./data/StackedChartData.csv",
								function(error, data) 
								{
									if (error) throw error;

									var data = data.filter(function(d){
											return d.Circle == circle;
									});

									data.forEach(function(d) 
													{
														d.TotalPairedSpectrum = 0;
														d.TotalUnpairedSpectrum = 0;
														
														if(freq.mhz800)
															d.TotalPairedSpectrum += parseFloat(d["800 Mhz"]);
														if(freq["mhz900"])
															d.TotalPairedSpectrum += parseFloat(d["900 Mhz"]);
														if(freq["mhz1800"])
															d.TotalPairedSpectrum += parseFloat(d["1800 Mhz"]);
														if(freq["mhz2100"])
															d.TotalPairedSpectrum += parseFloat(d["2100 Mhz"])

														if(freq["mhz2300"])
															d.TotalUnpairedSpectrum += parseFloat(d["2300 Mhz"]);
														if(freq["mhz2600"])
															d.TotalUnpairedSpectrum += parseFloat(d["2600 Mhz"]);
														
														d.total = (parseFloat(d.TotalPairedSpectrum) + parseFloat(d.TotalUnpairedSpectrum));
													}
												);
									data.sort(function(a, b) 
												{ 
													return (b.total - a.total);
												}
											);
									data.forEach(function(d) 
												{
													totalHolding = totalHolding +  d.total;	
												}
											);
									data.forEach(function(d) 
												{
													d.percentage = Math.round(d.total/totalHolding*100.00*100.00)/100 ;	
												}
											);

									var pie = d3.layout.pie()
											    .value(function(d) 
											    		{ 
											    			return d.total; 
											    		}
											    	  );

									var g = svg.selectAll(".arc")
									.data(pie(data))
									.enter()
									.append("g")
									.attr("class","arc")
									.attr("id", function(d, i) 
															{ 
																return "A"+i;
															});

									g.append("path")
									.attr("d", arc)
									.attr("title","10%")
									.style("fill", function(d) 
													{ 
														return color(d.data.Operator); 
													}
										  )
									.on("mousemove", function(d){
											//alert(d3.event.pageX + " " + d3.event.pageY);
										    div.style("left", d3.event.pageX+"px");
												  div.style("top", d3.event.pageY-25+"px");
												  div.style("display", "inline-block");
										    div.html((d.data.Operator + "<br/>" + d.data.percentage+ "%"));
										})
									.on("mouseout", function(d){
										    div.style("display", "none");
										});
								}
							);
					}
					function loadBarChart(circle,freq)
					{
						var margin = {top: 60, right: 20, bottom: 130, left: 40},
						    width = 600 -10 - margin.left - margin.right,
						    height = 500 -10 - margin.top - margin.bottom;

						var x = d3.scale.ordinal()
						    .rangeRoundBands([20, width], .1);

						var y = d3.scale.linear()
						    .rangeRound([height, 0]);

						var color = d3.scale.ordinal()
						    .range(["#0481A0","#03A0C6"]);

						var xAxis = d3.svg.axis()
						    .scale(x)
						    .orient("bottom");

						var yAxis = d3.svg.axis()
						    .scale(y)
						    .orient("left")
						    .tickFormat(d3.format(".2s"));

						$("#stackedBarChart").html("");
						var svg = d3.select("#stackedBarChart")
									.append("svg")
									.attr("width", width + margin.left + margin.right)
									.attr("height", height + margin.top + margin.bottom)
									.append("g")
									.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						d3.csv(
								"./data/StackedChartData.csv", 
								function(error, data) 
								{
									if (error) throw error;
									var data = data.filter(function(d){
											return d.Circle == circle;
									});

									data.forEach(function(d) 
													{														
														d.TotalPairedSpectrum = 0;
														d.TotalUnpairedSpectrum = 0;
													}
												);

									color.domain(d3.keys(data[0]).filter(function(key) 
																			{ 
																				return key == "TotalPairedSpectrum" || key == "TotalUnpairedSpectrum"; 
																			}
																		)
												);

									data.forEach(function(d) 
													{
														var y0 = 0;
														
														d.TotalPairedSpectrum = 0;
														d.TotalUnpairedSpectrum = 0;
														
														if(freq.mhz800)
															d.TotalPairedSpectrum += parseFloat(d["800 Mhz"]);
														if(freq["mhz900"])
															d.TotalPairedSpectrum += parseFloat(d["900 Mhz"]);
														if(freq["mhz1800"])
															d.TotalPairedSpectrum += parseFloat(d["1800 Mhz"]);
														if(freq["mhz2100"])
															d.TotalPairedSpectrum += parseFloat(d["2100 Mhz"])

														if(freq["mhz2300"])
															d.TotalUnpairedSpectrum += parseFloat(d["2300 Mhz"]);
														if(freq["mhz2600"])
															d.TotalUnpairedSpectrum += parseFloat(d["2600 Mhz"]);
														
														d.ages = color.domain().map(function(name) 
																						{ 
																							return {
																										name: name, 
																										y0: y0, 
																										y1: y0 += +d[name]
																									}; 
																						}
																					);
														d.total = d.ages[d.ages.length - 1].y1;
													}
												);
						/*
									data.sort(function(a, b) 
												{ 
													return b.total - a.total; 
												}
											);
						*/
									

									x.domain(data.map(function(d) 
														{ 
															return d.Operator; 
														}
													  )
											);
									y.domain(
												[0, 5 + d3.max(data, function(d) 
																	{ 
																		return d.total; 
																	}
														  )
											 	]
											);

									svg.append("g")
										.attr("class", "x axis")
										.attr("transform", "translate(0," + height + ")")
										.call(xAxis)
										.selectAll("text")
									    .attr("y", 5)
									    .attr("x", -15)
									    .attr("transform", "rotate(-45)")
									    .style("text-anchor", "end");


									svg.append("g")
										.attr("class", "y axis")
										.call(yAxis)
										.append("text")
										.attr("transform", "rotate(-90)")
										.attr("y", 6)
										.attr("dy", ".71em")
										.style("text-anchor", "end")
										.text("Total Spectrum Holding(in MHz)");

									var Operator = svg.selectAll(".Operator")
													.data(data)
													.enter().append("g")
													.attr("class", "g")
													.attr("transform", function(d) 
																		{ 
																			return "translate(" + x(d.Operator) + ",0)"; 
																		}
														 );

									Operator.selectAll("rect")
									.data(function(d) 
											{ 
												return d.ages; 
											}
										 )
									.enter().append("rect")
									.attr("width", x.rangeBand())
									.attr("y", function(d) 
												{ 
													return y(d.y1); 
												}
										 )
									.attr("height", function(d) 
														{ 
															return y(d.y0) - y(d.y1); 
														}
										 )
									.style("fill", function(d) 
													{ 
														return color(d.name); 
													}
										  )
									.on("mousemove", function(d){
										    div.style("left", d3.event.pageX+10+"px");
												  div.style("top", d3.event.pageY-25+"px");
												  div.style("display", "inline-block");
										    div.html((d.name + "<br/>" + (d.y1-d.y0).toString()));
										})
									.on("mouseout", function(d){
										    div.style("display", "none");
										});
					
								}
							);
					}
				</script>
			</div>
		</div>
		<div class="panel panel-default">
			<div class="panel-body">
				<ul class="nav nav-pills">
					<li role="presentation" class="active"><a class="pnl3 all">Price/MHz Analysis for All Bands</a></li>
					<li role="presentation" class="active"><a class="pnl3 bandwise">Band-wise Spectrum Holding</a></li>
					<li role="presentation" class="active"><a class="pnl3 pairedunpaired" >Paired-Unpaired Spectrum</a></li>
					<li role="presentation" class="active"><a class="pnl3 worlddata">Current World Spectrum Data</a></li>
				</ul>

				<div id="sec3" style="clear: both; ">
					<div id="priceAnalysisAll" style="float:left"></div>
				</div>
				
				<script>
					d3.selectAll("a.pnl3.all").on("click",renderpriceAnalysisAll);
					d3.selectAll("a.pnl3.bandwise").on("click",renderBandWise);
					d3.selectAll("a.pnl3.pairedunpaired").on("click",renderpairedunpaired);
					d3.selectAll("a.pnl3.worlddata").on("click",renderWorldData);

					function renderpriceAnalysisAll()
					{
						var legend_width = 120;

						var margin = {top: 20, right: 10, bottom: 30, left: 90},
						width = 1000 - margin.left - margin.right+legend_width,
						height = 450 - margin.top - margin.bottom;

						var x = d3.scale.ordinal()
						.rangeRoundBands([0, width], .1);

						var yAbsolute = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var yRelative = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var color = d3.scale.ordinal()

						.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);


						var xAxis = d3.svg.axis()
						.scale(x)
						.orient("bottom");

						var yAxisRelative = d3.svg.axis()
						.scale(yRelative)
						.orient("left")
						.tickFormat(d3.format(".1%"));

						var yAxisAbsolute = d3.svg.axis()
						.scale(yAbsolute)
						.orient("left")
						.tickFormat(d3.format(".2s"));

						d3.select("#priceAnalysisAll").html("");

						var svg = d3.select("#priceAnalysisAll").append("svg")
						.attr("width", width + margin.left + margin.right+legend_width)
						.attr("height", height + margin.top + margin.bottom)
						.append("g")
						.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						d3.csv("data/bar_data.csv", function(error, data) 
						{
							color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Circle"; }));


							data.forEach(function(d) {
								var mycircle = d.Circle;
								var y0 = 0;
								d.price = color.domain().map(function(name) { return {mycircle:mycircle, name: name, y0: y0, y1: y0 += +d[name]}; });

								d.total = d.price[d.price.length - 1].y1;// the last row	
								d.pct = [];

								for (var i=0;i <d.price.length;i ++ )
								{
									var y_coordinate = +d.price[i].y1/d.total;
									var y_height1 = (d.price[i].y1)/d.total; 
									var y_height0 = (d.price[i].y0)/d.total; 
									var y_pct = y_height1 - y_height0;
									d.pct.push({
									y_coordinate: y_coordinate,
									y_height1: y_height1,
									y_height0: y_height0,
									name: d.price[i].name,
									mycircle: d.Circle,
									y_pct: y_pct

									});
								}
							});

							data.sort(function(a, b) { return b.total - a.total; });  

							x.domain(data.map(function(d) { return d.Circle; }));
							yAbsolute.domain([0, d3.max(data, function(d) { return d.total; })]);//Absolute View scale 
							yRelative.domain([0,1])// Relative View domain 

							var absoluteView = false // define a boolean variable, true is absolute view, false is relative view
							// Initial view is absolute 

							svg.append("g")
							.attr("class", "x axis")
							.attr("transform", "translate(0," + height + ")")
							.call(xAxis);

							//Define the rect of Relative 		

							var stateRelative = svg.selectAll(".relative")
							.data(data)
							.enter().append("g")
							.attr("class", "relative")
							.attr("transform", function(d) { 	  
								return "translate(" + "10 "+ ",0)"; 
								});

							stateRelative.selectAll("rect")
							.data(function(d) {
									return d.pct;		  
								})
							.enter().append("rect")
							.attr("width", x.rangeBand())
							.attr("y", function(d) {
								return yRelative(d.y_coordinate); 
								})
							.attr("x",function(d) {return x(d.mycircle)})
							.attr("height", function(d) { 
								return yRelative(d.y_height0) - yRelative(d.y_height1); //distance 
								})
							.attr("fill", function(d){return color(d.name)})
							.attr("stroke","pink")
							.attr("stroke-width",0.2)
							.attr("id",function(d) {return d.mycircle})
							.attr("class","relative")
							.attr("id",function(d) {return d.mycircle})
							.style("pointer-events","all");


							stateRelative.selectAll("rect")
							.on("mousemove", function(d){
									if(!absoluteView)
									{
										d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
										div.style("left", d3.event.pageX+10+"px");
										div.style("top", d3.event.pageY-25+"px");
										div.style("display", "inline-block");
										div.html(Math.floor(d.y_pct.toFixed(2)*100) + " % Price/MHz of " + d.mycircle + " in "+ d.name);
									}
								})
							.on("mouseout", function(d){
								    div.style("display", "none");
								    d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
								});

							// End of define rect of relative		 

							// define rect for absolute 

							var stateAbsolute= svg.selectAll(".absolute")
							.data(data)
							.enter().append("g")
							.attr("class", "absolute")
							.attr("transform", function(d) { return "translate(" + "10" + ",0)"; });

							stateAbsolute.selectAll("rect")
							.data(function(d) { return d.price})
							.enter().append("rect")
							.attr("width", x.rangeBand())
							.attr("y", function(d) { 
								return yAbsolute(d.y1); 
								})
							.attr("x",function(d) {
								return x(d.mycircle)
								})
							.attr("height", function(d) { 
								return yAbsolute(d.y0) - yAbsolute(d.y1); 
								})
							.attr("fill", function(d){
								return color(d.name)
								})
							.attr("id",function(d) {
								return d.mycircle
								})
							.attr("class","absolute")
							.style("pointer-events","all")
							.attr("opacity",0); // initially it is invisible, i.e. start with Absolute View 

							//define two different scales, but one of them will always be hidden. 	  	
							svg.append("g")
							.attr("class", "y axis absolute")
							.call(yAxisAbsolute)
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 5)
							.attr("dy", ".70em")
							.style("text-anchor", "end")
							.text(" Price/MHz in Crores of Rupees");

							svg.append("g")
							.attr("class", "y axis relative")
							.call(yAxisRelative)
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 5)
							.attr("dy", ".70em")
							.style("text-anchor", "end")
							.text("Percentage Price/MHz in Crores of Rupees");

							svg.select(".y.axis.absolute").style("opacity",0);	 	

							// end of define absolute
							// adding legend

							var legend = svg.selectAll(".legend")
							.data(color.domain().slice().reverse())
							.enter().append("g")
							.attr("class", "legend")
							.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

							legend.append("rect")
							.attr("x", width - 18+legend_width)
							.attr("width", 18)
							.attr("height", 18)
							.attr("fill", color);		


							legend.append("text")
							.attr("x", width - 24+legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text(function(d) { if(d !== "Circle") return d;  });

							var clickButton = svg.selectAll(".clickButton")
							.data([80,50])
							.enter().append("g")
							.attr("class","clickButton")
							.attr("transform","translate(0," + 180 +")");	

							clickButton.append("text")
							.attr("x", width + legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text("Switch the Views:")
							.style("text-decoration", "underline") 
							.style("font-size", "12px")
							.attr("fill","blue")
							.attr("id","clickChangeView") ;	

							var clickButton2 = svg.selectAll(".clickButton2")
							.data([80,50])
							.enter().append("g")
							.attr("class","clickButton2")
							.attr("transform","translate(0," + 200 +")");	

							clickButton2.append("text")
							.attr("x", width + legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text("Absolute/Relative")
							.style("text-decoration", "underline") 
							.style("font-size", "12px")
							.attr("fill","blue")
							.attr("id","clickChangeView") ;		   

							// start with relative view
							Transition2Relative(); 

							// Switch view on click the clickButton 
							d3.selectAll("#"+ "clickChangeView")
							.on("click",function(){

							if(absoluteView){ // absolute, otherwise relative 
							Transition2Relative();			
							} else {
							Transition2Absolute();				
							}
							absoluteView = !absoluteView // change the current view status 		
							});

							function Transition2Absolute()
							{		 
								//Currently it is Relative  
								stateRelative.selectAll("rect").transition().duration(2000).style("opacity",0);		
								stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",1);//show absolute view rectangles 		
								svg.select(".y.axis.relative").transition().duration(2000).style("opacity",0);	 		
								svg.select(".y.axis.absolute").transition().duration(2000).style("opacity",1);// show absolute view axis
							}

							function Transition2Relative()
							{
								//Currently it is absolute
								stateAbsolute.selectAll("rect").transition().duration(2000).attr("fill",function(d) {return  color(d.name)})
								stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",0);//show absolute view rectangles 		  
								stateRelative.selectAll("rect").transition().duration(2000).style("opacity",1);  		
								svg.select(".y.axis.relative").transition().duration(2000).style("opacity",1);		
								svg.select(".y.axis.absolute").transition().duration(2000).style("opacity",0);// show absolute view axis	  	

							}

						});
					}
					function renderBandWise()
					{
						var legend_width = 140;

						var margin = {top: 20, right: 20, bottom: 20, left: 90},
						width = 800 - margin.left - margin.right+legend_width,
						height = 450 - margin.top - margin.bottom;

						var x = d3.scale.ordinal()
						.rangeRoundBands([0, width], .1);

						var yAbsolute = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var yRelative = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var color = d3.scale.ordinal()

						.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);


						var xAxis = d3.svg.axis()
						.scale(x)
						.orient("bottom");

						var yAxisRelative = d3.svg.axis()
						.scale(yRelative)
						.orient("left")
						.tickFormat(d3.format(".1%"));

						var yAxisAbsolute = d3.svg.axis()
						.scale(yAbsolute)
						.orient("left")
						.tickFormat(d3.format(".2s"));

						d3.select("#priceAnalysisAll").html("");
						
						var svg = d3.select("#priceAnalysisAll").append("svg")
						.attr("width", width + margin.left + margin.right+legend_width)
						.attr("height", height + margin.top + margin.bottom)
						.append("g")
						.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						d3.csv("data/totalholdingdatabandwise.csv", function(error, data) 
						{
							var nestData=d3.nest().key(function(d){return (d['LSA']+d['Operator'])}).entries(data);
							color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Operator"&& key!=="LSA"; }));
							nestData.forEach(function(d) 
							{
								var mycircle = d.values[0].Operator;
								var y0 = 0;
								d.values[0].price = color.domain().map(function(name) { return { mycircle:mycircle, name: name, y0: y0, y1: y0 += +d.values[0][name]}; });
								d.values[0].total = d.values[0].price[d.values[0].price.length - 1].y1;// the last row	
								d.values[0].pct = [];
								for (var i=0;i <d.values[0].price.length;i ++ ){		
								var y_coordinate = +d.values[0].price[i].y1/d.values[0].total;
								var y_height1 = (d.values[0].price[i].y1)/d.values[0].total; 
								var y_height0 = (d.values[0].price[i].y0)/d.values[0].total; 
								var y_pct = y_height1 - y_height0;
								d.values[0].pct.push({
								y_coordinate: y_coordinate,
								y_height1: y_height1,
								y_height0: y_height0,
								name: d.values[0].price[i].name,
								mycircle: d.values[0].Operator,
								y_pct: y_pct			
								});		
								}	
							});
							filteredData=nestData.filter(function(d){
							return d.values[0].LSA=="Andhra Pradesh";
							})
							filteredData.sort(function(a, b) { return b.values[0].total - a.values[0].total; });  
							x.domain(filteredData.map(function(d) { return d.values[0].Operator; }));
							yAbsolute.domain([0, d3.max(filteredData, function(d) { return d.values[0].total; })]);//Absolute View scale 
							yRelative.domain([0,1])// Relative View domain 
							var absoluteView = false // define a boolean variable, true is absolute view, false is relative view
							// Initial view is absolute 

							svg.append("g")
							.attr("class", "x_axis")
							.attr("transform", "translate(0," + height + ")")
							.call(xAxis);
							//Define the rect of Relative 		
							var stateRelative = svg.selectAll(".relative")
							.data(filteredData,key_func)
							.enter().append("g")
							.attr("class", "relative")
							.attr("transform", function(d) { 	  
							return "translate(" + "10 "+ ",0)"; 
							});
							function key_func(d){
							return d['key']
							}	  
							stateRelative.selectAll("rect")
							.data(function(d){
							return d.values[0].pct
							})
							.enter().append("rect")
							.attr("width", x.rangeBand())
							.attr("y", function(d) {
							return yRelative(d.y_coordinate); 
							})
							.attr("x",function(d) {return x(d.mycircle)})
							.attr("height", function(d) { 
							return yRelative(d.y_height0) - yRelative(d.y_height1); //distance 
							})
							.attr("fill", function(d){return color(d.name)})
							.attr("stroke","pink")
							.attr("stroke-width",0.2)
							.attr("id",function(d) {return d.mycircle})
							//.attr("class","relative")
							//.attr("id",function(d) {return d.mycircle})
							.style("pointer-events","all");
							stateRelative.selectAll("rect")
							.on("mousemove", function(d){
									if(!absoluteView)
									{
										d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
										div.style("left", d3.event.pageX+10+"px");
										div.style("top", d3.event.pageY-25+"px");
										div.style("display", "inline-block");
										div.html(Math.floor(d.y_pct.toFixed(2)*100) + " % Spectrum of " + d.mycircle + " in "+ d.name);
									}
								})
							.on("mouseout", function(d){
								    div.style("display", "none");
								    d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
								});

							// End of define rect of relative		 

							// define rect for absolute 
							var stateAbsolute= svg.selectAll(".absolute")
							.data(filteredData,key_func)
							.enter().append("g")
							.attr("class", "absolute")
							.attr("transform", function(d) { return "translate(" + "10" + ",0)"; });
							stateAbsolute.selectAll("rect")
							.data(function(d) { return d.values[0].price})
							.enter().append("rect")
							.attr("width", x.rangeBand())
							.attr("y", function(d) { 				  
							return yAbsolute(d.y1); 
							})
							.attr("x",function(d) {
							return x(d.mycircle)
							})
							.attr("height", function(d) { 
							return yAbsolute(d.y0) - yAbsolute(d.y1); 
							})
							.attr("fill", function(d){
							return color(d.name)
							})
							.attr("id",function(d) {
							return d.mycircle
							})
							//.attr("class","absolute")
							.style("pointer-events","all")
							.attr("opacity",0); // initially it is invisible, i.e. start with Absolute View 

							//define two different scales, but one of them will always be hidden. 	  	
							svg.append("g")
							.attr("class", "y axis abs")
							.call(yAxisAbsolute)
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 5)
							.attr("dy", ".70em")
							.style("text-anchor", "end")
							.text(" Band-wise Frequency Spectrum in MHz");

							svg.append("g")
							.attr("class", "y axis rel")
							.call(yAxisRelative)
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 5)
							.attr("dy", ".70em")
							.style("text-anchor", "end")
							.text("Percentage of Band-wise Frequency Spectrum in MHz");

							svg.select(".y.axis.abs").style("opacity",0);	 
							// end of define absolute


							// adding legend


							var legend = svg.selectAll(".legend")
							.data(color.domain().slice().reverse())
							.enter().append("g")
							.attr("class", "legend")
							.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

							legend.append("rect")
							.attr("x", width - 18+legend_width)
							.attr("width", 18)
							.attr("height", 18)
							.attr("fill", color);		


							legend.append("text")
							.attr("x", width - 24+legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text(function(d) { if(d !== "Circle") return d;  });

							var clickButton = svg.selectAll(".clickButton")
							.data([80,50])
							.enter().append("g")
							.attr("class","clickButton")
							.attr("transform","translate(0," + 180 +")");	

							clickButton.append("text")
							.attr("x", width + legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text("Switch the Views:")
							.style("text-decoration", "underline") 
							.style("font-size", "12px")
							.attr("fill","blue")
							.attr("id","clickChangeView") ;	

							var clickButton2 = svg.selectAll(".clickButton2")
							.data([80,50])
							.enter().append("g")
							.attr("class","clickButton2")
							.attr("transform","translate(0," + 200 +")");	

							clickButton2.append("text")
							.attr("x", width + legend_width)
							.attr("y", 9)
							.attr("dy", ".35em")
							.style("text-anchor", "end")
							.text("Absolute/Relative")
							.style("text-decoration", "underline") 
							.style("font-size", "12px")
							.attr("fill","blue")
							.attr("id","clickChangeView") ;		   

							// start with relative view
							Transition2Relative(); 
							// Switch view on click the clickButton 
							d3.selectAll("#"+ "clickChangeView")
							.on("click",function(){
								if(absoluteView)
								{ // absolute, otherwise relative 
									Transition2Relative();			
								} 
								else 
								{
									Transition2Absolute();				
								}
								absoluteView = !absoluteView // change the current view status 		
							});

							function Transition2Absolute(){		 
							//Currently it is Relative  
							stateRelative.selectAll("rect").transition().duration(2000).style("opacity",0);		
							stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",1);//show absolute view rectangles 		
							svg.select(".y.axis.rel").transition().duration(2000).style("opacity",0);	 		
							svg.select(".y.axis.abs").transition().duration(2000).style("opacity",1);// show absolute view axis

							}

							function Transition2Relative(){
							//Currently it is absolute
							stateAbsolute.selectAll("rect").transition().duration(2000).attr("fill",function(d) {return  color(d.name)})
							stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",0);//show absolute view rectangles 		  
							stateRelative.selectAll("rect").transition().duration(2000).style("opacity",1);  		
							svg.select(".y.axis.rel").transition().duration(2000).style("opacity",1);		
							svg.select(".y.axis.abs").transition().duration(2000).style("opacity",0);// show absolute view axis	  	

							}
							//plotstack
							function plotStack()
							{
								//alert("hello");

								var filterData=nestData.filter(function(d){
								return d.values[0].LSA==selected;
								})


								filterData.sort(function(a, b) { return b.values[0].total - a.values[0].total; });  

								x.domain(filterData.map(function(d) { return d.values[0].Operator; }));
								yAbsolute.domain([0, d3.max(filterData, function(d) { return d.values[0].total; })]);//Absolute View scale 
								yRelative.domain([0,1])// Relative View domain 

								absoluteView = false // define a boolean variable, true is absolute view, false is relative view
								// Initial view is absolute 
								axisx=svg.selectAll('.x_axis').data([])
								axisx.exit().remove();
								svg.append("g")
								.attr("class", "x_axis")
								.attr("transform", "translate(0," + height + ")")
								.call(xAxis);

								function keyFun(d){
								return d['key'];
								}


								stateRelative = svg.selectAll(".relative")
								stateRelative=stateRelative.data(filterData,keyFun)
								stateRelative.exit().remove()

								stateRelative=stateRelative.enter().append("g")
								.attr("class", "relative")
								.attr("transform", function(d) { 	  
								return "translate(" + "10 "+ ",0)"; 
								});

								stateRelative.selectAll("rect")
								.data(function(d) {
								return d.values[0].pct;		  
								})
								.enter().append("rect")
								.attr("width", x.rangeBand())
								.attr("y", function(d) {
								return yRelative(d.y_coordinate); 
								})
								.attr("x",function(d) {return x(d.mycircle)})
								.attr("height", function(d) { 
								return yRelative(d.y_height0) - yRelative(d.y_height1); //distance 
								})
								.attr("fill", function(d){return color(d.name)})
								.attr("stroke","pink")
								.attr("stroke-width",0.2)
								.attr("id",function(d) {return d.mycircle})
								//.attr("class","relative")
								//.attr("id",function(d) {return d.mycircle})
								.style("pointer-events","all");


								stateRelative.selectAll("rect")
								.on("mousemove", function(d){
									if(!absoluteView)
									{
										d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
										div.style("left", d3.event.pageX+10+"px");
										div.style("top", d3.event.pageY-25+"px");
										div.style("display", "inline-block");
										div.html(Math.floor(d.y_pct.toFixed(2)*100) + " % Spectrum of " + d.mycircle + " in "+ d.name);
									}
								})
								.on("mouseout", function(d){
									    div.style("display", "none");
									    d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
									});

								//end of relative
								// define rect for absolute 
								stateAbsolute= svg.selectAll(".absolute")
								.data(filterData,keyFun)
								stateAbsolute.exit().remove();
								stateAbsolute=stateAbsolute
								.enter().append("g")
								.attr("class", "absolute")
								.attr("transform", function(d) { return "translate(" + "10" + ",0)"; });

								stateAbsolute.selectAll("rect")
								.data(function(d) { return d.values[0].price})
								.enter().append("rect")
								.attr("width", x.rangeBand())
								.attr("y", function(d) {					  
								return yAbsolute(d.y1); 
								})
								.attr("x",function(d) {
								return x(d.mycircle)
								})
								.attr("height", function(d) { 
								return yAbsolute(d.y0) - yAbsolute(d.y1); 
								})
								.attr("fill", function(d){
								return color(d.name)
								})
								.attr("id",function(d) {
								return d.mycircle
								})
								//.attr("class","absolute")
								.style("pointer-events","all")
								.attr("opacity",0); // initially it is invisible, i.e. start with Absolute View 

							}
							var selected
							//select
							var select = d3.select("#priceAnalysisAll")
							.append("div")
							.append("select")
							select
							.on("change", function(d) {
							var value = d3.select(this).property("value");
							//alert("Total Spectrum holding for Operators in "+value);
							selected = this.value;
							//if(selected == "Assam"){d3.csv("totalholdingdata.csv")}
							plotStack();
							});
							select.selectAll("option")
							.data(d3.map(data, function(d){return d.LSA;}).keys())
							.enter()
							.append("option")
							.text(function(d){return d;})
							.attr("value",function(d){return d;});
						});
					}
					function renderpairedunpaired()
					{
						var legend_width = 140;

						var margin = {top: 20, right: 20, bottom: 20, left: 90},
						width = 800 - margin.left - margin.right+legend_width,
						height = 450 - margin.top - margin.bottom;

						var x = d3.scale.ordinal()
						.rangeRoundBands([0, width], .1);

						var yAbsolute = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var yRelative = d3.scale.linear() // for absolute scale
						.rangeRound([height, 0]);

						var color = d3.scale.ordinal()

						.range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);


						var xAxis = d3.svg.axis()
						.scale(x)
						.orient("bottom");

						var yAxisRelative = d3.svg.axis()
						.scale(yRelative)
						.orient("left")
						.tickFormat(d3.format(".1%"));

						var yAxisAbsolute = d3.svg.axis()
						.scale(yAbsolute)
						.orient("left")
						.tickFormat(d3.format(".2s"));

						d3.select("#priceAnalysisAll").html("");

						var svg = d3.select("#priceAnalysisAll").append("svg")
						.attr("width", width + margin.left + margin.right+legend_width)
						.attr("height", height + margin.top + margin.bottom)
						.append("g")
						.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						d3.csv("data/totalholdingdata.csv", function(error, data) {
						var nestData=d3.nest().key(function(d){return (d['LSA']+d['Operator'])}).entries(data);
						color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Operator"&& key!=="LSA"; }));
						nestData.forEach(function(d) {
						var mycircle = d.values[0].Operator;
						var y0 = 0;
						d.values[0].price = color.domain().map(function(name) { return { mycircle:mycircle, name: name, y0: y0, y1: y0 += +d.values[0][name]}; });
						d.values[0].total = d.values[0].price[d.values[0].price.length - 1].y1;// the last row	
						d.values[0].pct = [];
						for (var i=0;i <d.values[0].price.length;i ++ ){		
						var y_coordinate = +d.values[0].price[i].y1/d.values[0].total;
						var y_height1 = (d.values[0].price[i].y1)/d.values[0].total; 
						var y_height0 = (d.values[0].price[i].y0)/d.values[0].total; 
						var y_pct = y_height1 - y_height0;
						d.values[0].pct.push({
						y_coordinate: y_coordinate,
						y_height1: y_height1,
						y_height0: y_height0,
						name: d.values[0].price[i].name,
						mycircle: d.values[0].Operator,
						y_pct: y_pct			
						});		
						}	
						});
						filteredData=nestData.filter(function(d){
						return d.values[0].LSA=="Andhra Pradesh";
						})
						filteredData.sort(function(a, b) { return b.values[0].total - a.values[0].total; });  
						x.domain(filteredData.map(function(d) { return d.values[0].Operator; }));
						yAbsolute.domain([0, d3.max(filteredData, function(d) { return d.values[0].total; })]);//Absolute View scale 
						yRelative.domain([0,1])// Relative View domain 
						var absoluteView = false // define a boolean variable, true is absolute view, false is relative view
						// Initial view is absolute 

						svg.append("g")
						.attr("class", "x_axis")
						.attr("transform", "translate(0," + height + ")")
						.call(xAxis);
						//Define the rect of Relative 		
						var stateRelative = svg.selectAll(".relative")
						.data(filteredData,key_func)
						.enter().append("g")
						.attr("class", "relative")
						.attr("transform", function(d) { 	  
						return "translate(" + "10 "+ ",0)"; 
						});
						function key_func(d){
						return d['key']
						}	  
						stateRelative.selectAll("rect")
						.data(function(d){
						return d.values[0].pct
						})
						.enter().append("rect")
						.attr("width", x.rangeBand())
						.attr("y", function(d) {
						return yRelative(d.y_coordinate); 
						})
						.attr("x",function(d) {return x(d.mycircle)})
						.attr("height", function(d) { 
						return yRelative(d.y_height0) - yRelative(d.y_height1); //distance 
						})
						.attr("fill", function(d){return color(d.name)})
						.attr("stroke","pink")
						.attr("stroke-width",0.2)
						.attr("id",function(d) {return d.mycircle})
						//.attr("class","relative")
						//.attr("id",function(d) {return d.mycircle})
						.style("pointer-events","all");
						stateRelative.selectAll("rect")
						.on("mousemove", function(d){
								if(!absoluteView)
								{
									d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
									div.style("left", d3.event.pageX+10+"px");
									div.style("top", d3.event.pageY-25+"px");
									div.style("display", "inline-block");
									div.html(Math.floor(d.y_pct.toFixed(2)*100) + " % Spectrum Holding of " + d.mycircle + " in "+ d.name);
								}
							})
						.on("mouseout", function(d){
							    div.style("display", "none");
							    d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
							});
						
						// End of define rect of relative		 
						// define rect for absolute 

						var stateAbsolute= svg.selectAll(".absolute")
						.data(filteredData,key_func)
						.enter().append("g")
						.attr("class", "absolute")
						.attr("transform", function(d) { return "translate(" + "10" + ",0)"; });
						stateAbsolute.selectAll("rect")
						.data(function(d) { return d.values[0].price})
						.enter().append("rect")
						.attr("width", x.rangeBand())
						.attr("y", function(d) { 				  
						return yAbsolute(d.y1); 
						})
						.attr("x",function(d) {
						return x(d.mycircle)
						})
						.attr("height", function(d) { 
						return yAbsolute(d.y0) - yAbsolute(d.y1); 
						})
						.attr("fill", function(d){
						return color(d.name)
						})
						.attr("id",function(d) {
						return d.mycircle
						})
						//.attr("class","absolute")
						.style("pointer-events","all")
						.attr("opacity",0); // initially it is invisible, i.e. start with Absolute View 

						//define two different scales, but one of them will always be hidden. 	  	
						svg.append("g")
						.attr("class", "y axis abs")
						.call(yAxisAbsolute)
						.append("text")
						.attr("transform", "rotate(-90)")
						.attr("y", 5)
						.attr("dy", ".70em")
						.style("text-anchor", "end")
						.text(" Paired and Unpaired Frequency Spectrum in MHz");

						svg.append("g")
						.attr("class", "y axis rel")
						.call(yAxisRelative)
						.append("text")
						.attr("transform", "rotate(-90)")
						.attr("y", 5)
						.attr("dy", ".70em")
						.style("text-anchor", "end")
						.text("Percentage Paired and Unpaired Frequency Spectrum in MHz");

						svg.select(".y.axis.abs").style("opacity",0);	 
						// end of define absolute

						// adding legend

						var legend = svg.selectAll(".legend")
						.data(color.domain().slice().reverse())
						.enter().append("g")
						.attr("class", "legend")
						.attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

						legend.append("rect")
						.attr("x", width - 18+legend_width)
						.attr("width", 18)
						.attr("height", 18)
						.attr("fill", color);		


						legend.append("text")
						.attr("x", width - 24+legend_width)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "end")
						.text(function(d) { if(d !== "Circle") return d;  });

						var clickButton = svg.selectAll(".clickButton")
						.data([80,50])
						.enter().append("g")
						.attr("class","clickButton")
						.attr("transform","translate(0," + 180 +")");	

						clickButton.append("text")
						.attr("x", width + legend_width)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "end")
						.text("Switch the Views:")
						.style("text-decoration", "underline") 
						.style("font-size", "12px")
						.attr("fill","blue")
						.attr("id","clickChangeView") ;	

						var clickButton2 = svg.selectAll(".clickButton2")
						.data([80,50])
						.enter().append("g")
						.attr("class","clickButton2")
						.attr("transform","translate(0," + 200 +")");	

						clickButton2.append("text")
						.attr("x", width + legend_width)
						.attr("y", 9)
						.attr("dy", ".35em")
						.style("text-anchor", "end")
						.text("Absolute/Relative")
						.style("text-decoration", "underline") 
						.style("font-size", "12px")
						.attr("fill","blue")
						.attr("id","clickChangeView") ;		   

						// start with relative view
						Transition2Relative(); 
						// Switch view on click the clickButton 
						d3.selectAll("#"+ "clickChangeView")
						.on("click",function(){
						if(absoluteView){ // absolute, otherwise relative 
						Transition2Relative();			
						} else {
						Transition2Absolute();				
						}
						absoluteView = !absoluteView // change the current view status 		
						});

						function Transition2Absolute(){		 
						//Currently it is Relative  
						stateRelative.selectAll("rect").transition().duration(2000).style("opacity",0);		
						stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",1);//show absolute view rectangles 		
						svg.select(".y.axis.rel").transition().duration(2000).style("opacity",0);	 		
						svg.select(".y.axis.abs").transition().duration(2000).style("opacity",1);// show absolute view axis

						}

						function Transition2Relative(){
						//Currently it is absolute
						stateAbsolute.selectAll("rect").transition().duration(2000).attr("fill",function(d) {return  color(d.name)})
						stateAbsolute.selectAll("rect").transition().duration(2000).style("opacity",0);//show absolute view rectangles 		  
						stateRelative.selectAll("rect").transition().duration(2000).style("opacity",1);  		
						svg.select(".y.axis.rel").transition().duration(2000).style("opacity",1);		
						svg.select(".y.axis.abs").transition().duration(2000).style("opacity",0);// show absolute view axis	  	

						}
						//plotstack
						function plotStack(){
						//alert("hello");

						var filterData=nestData.filter(function(d){
						return d.values[0].LSA==selected;
						})


						filterData.sort(function(a, b) { return b.values[0].total - a.values[0].total; });  

						x.domain(filterData.map(function(d) { return d.values[0].Operator; }));
						yAbsolute.domain([0, d3.max(filterData, function(d) { return d.values[0].total; })]);//Absolute View scale 
						yRelative.domain([0,1])// Relative View domain 

						absoluteView = false // define a boolean variable, true is absolute view, false is relative view
						// Initial view is absolute 
						axisx=svg.selectAll('.x_axis').data([])
						axisx.exit().remove();
						svg.append("g")
						.attr("class", "x_axis")
						.attr("transform", "translate(0," + height + ")")
						.call(xAxis);

						function keyFun(d){
						return d['key'];
						}


						stateRelative = svg.selectAll(".relative")
						stateRelative=stateRelative.data(filterData,keyFun)
						stateRelative.exit().remove()

						stateRelative=stateRelative.enter().append("g")
						.attr("class", "relative")
						.attr("transform", function(d) { 	  
						return "translate(" + "10 "+ ",0)"; 
						});

						stateRelative.selectAll("rect")
						.data(function(d) {
						return d.values[0].pct;		  
						})
						.enter().append("rect")
						.attr("width", x.rangeBand())
						.attr("y", function(d) {
						return yRelative(d.y_coordinate); 
						})
						.attr("x",function(d) {return x(d.mycircle)})
						.attr("height", function(d) { 
						return yRelative(d.y_height0) - yRelative(d.y_height1); //distance 
						})
						.attr("fill", function(d){return color(d.name)})
						.attr("stroke","pink")
						.attr("stroke-width",0.2)
						.attr("id",function(d) {return d.mycircle})
						//.attr("class","relative")
						//.attr("id",function(d) {return d.mycircle})
						.style("pointer-events","all");


						stateRelative.selectAll("rect")
						.on("mousemove", function(d){
								if(!absoluteView)
								{
									d3.select(this).attr("stroke","blue").attr("stroke-width",0.8);							
									div.style("left", d3.event.pageX+10+"px");
									div.style("top", d3.event.pageY-25+"px");
									div.style("display", "inline-block");
									div.html(Math.floor(d.y_pct.toFixed(2)*100) + " % Spectrum Holding of " + d.mycircle + " in "+ d.name);
								}
							})
						.on("mouseout", function(d){
							    div.style("display", "none");
							    d3.select(this).attr("stroke","pink").attr("stroke-width",0.2);
							});
						
						//end of relative
						// define rect for absolute 

						stateAbsolute= svg.selectAll(".absolute")
						.data(filterData,keyFun)
						stateAbsolute.exit().remove();
						stateAbsolute=stateAbsolute
						.enter().append("g")
						.attr("class", "absolute")
						.attr("transform", function(d) { return "translate(" + "10" + ",0)"; });

						stateAbsolute.selectAll("rect")
						.data(function(d) { return d.values[0].price})
						.enter().append("rect")
						.attr("width", x.rangeBand())
						.attr("y", function(d) {					  
						return yAbsolute(d.y1); 
						})
						.attr("x",function(d) {
						return x(d.mycircle)
						})
						.attr("height", function(d) { 
						return yAbsolute(d.y0) - yAbsolute(d.y1); 
						})
						.attr("fill", function(d){
						return color(d.name)
						})
						.attr("id",function(d) {
						return d.mycircle
						})
						//.attr("class","absolute")
						.style("pointer-events","all")
						.attr("opacity",0); // initially it is invisible, i.e. start with Absolute View 
						}

						var selected
						//select
						var select = d3.select("#priceAnalysisAll")
						.append("div")
						.append("select")
						select
						.on("change", function(d) {
						var value = d3.select(this).property("value");
						//alert("Total Spectrum holding for Operators in "+value);
						selected = this.value;
						//if(selected == "Assam"){d3.csv("totalholdingdata.csv")}
						plotStack();
						});
						select.selectAll("option")
						.data(d3.map(data, function(d){return d.LSA;}).keys())
						.enter()
						.append("option")
						.text(function(d){return d;})
						.attr("value",function(d){return d;});
						});
					}
					function renderWorldData()
					{
						function draw(geo_data) 
						{
							var margin = 75,
							width = 1000 - margin,
							height = 600 - margin;

							d3.select("#priceAnalysisAll").html("");

							var svg = d3.select("#priceAnalysisAll")
							.append("svg")
							.attr("width", width + margin)
							.attr("height", height + margin)
							.append('g')
							.attr('class', 'map');

							var projection = d3.geo.mercator()
							.scale(120)
							.translate( [width / 2, height / 1.5]);

							var path = d3.geo.path().projection(projection);
							var map = svg.selectAll('path')
							.data(geo_data.features)
							.enter()
							.append('path')
							.attr('d', path)
							.attr('country',function(d){return d['properties']['name']})
							.style('fill', 'lightBlue')
							.style('stroke', 'black')
							.style('stroke-width', 0.5);

							function plot_points(data)
							{
							
								var nestData = d3.nest().key(function(d){return (d['Countries']+d['Band'])}).entries(data);
								var max_price = d3.max(nestData, function(d){return +d.values[0]['Price']});
								var radius = d3.scale.linear()
								.domain([0,max_price])
								.range([0,20]);

								svg.append('g')
								.attr("class", "wbubble")
								.selectAll("circle")
								//.data([[78,11],[72,23]])
								.data(nestData.sort(function(a,b){
								return +b.values[0]['Price'] - +a.values[0]['Price']
								}),key_func)
								//.data(nested)
								.enter()
								.append("circle")
								.attr('cx', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[0]; })
								.attr('cy', function(d) { return projection([d.values[0]['long'],d.values[0]['lat']])[1]; })
								.attr('r', function(d){return radius(+d.values[0]['Price'])})
								.attr('class',function(d){return 'b'+d.values[0]['Band']})
								.attr('fill','green');
								d3.selectAll("g.wbubble").selectAll('circle.b800').attr('fill','orange').attr('opacity',0.6);
								d3.selectAll("g.wbubble").selectAll('circle.b900').attr('fill','red').attr('opacity',0.6);
								d3.selectAll("g.wbubble").selectAll('circle.b1800').attr('fill','green').attr('opacity',0.6);
								d3.selectAll("g.wbubble").selectAll('circle.b2100').attr('fill','purple').attr('opacity',0.6);
								function key_func(d) {
									return d['key'];
								}
							}
						d3.csv("data/world.csv",plot_points);

						}
						d3.json("data/world_countries.json", draw);
					}
					renderpriceAnalysisAll();
				</script>
			</div>
		</div>
	</div>